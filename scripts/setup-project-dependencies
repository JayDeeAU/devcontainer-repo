#!/usr/bin/env bash
# setup-project-dependencies
# Automated project dependency setup (replaces complex monorepo detection)

set -e

echo "ğŸš€ Setting up project dependencies..."

# Ensure Poetry is in PATH for joe user
export PATH="/home/joe/.local/bin:$PATH"

# Poetry setup (if pyproject.toml exists)
if [ -f "pyproject.toml" ]; then
    echo "ğŸ Setting up Poetry project..."
    poetry config virtualenvs.in-project true
    poetry install
fi

# pnpm setup (if package.json exists and not in node_modules)
if [ -f "package.json" ] && [[ "$PWD" != *"node_modules"* ]]; then
    echo "ğŸ“¦ Setting up pnpm project..."
    pnpm install
fi

# Auto-detect common monorepo structure
for dir in frontend backend api web server magmabi; do
    if [ -d "$dir" ]; then
        echo "ğŸ“ Found $dir directory, checking for dependencies..."
        
        if [ -f "$dir/pyproject.toml" ]; then
            echo "ğŸ Setting up Poetry in $dir..."
            cd "$dir"
            poetry config virtualenvs.in-project true
            poetry install || echo "âš ï¸ Poetry install failed for $dir"
            cd ..
        fi
        
        if [ -f "$dir/package.json" ]; then
            echo "ğŸ“¦ Setting up pnpm in $dir..."
            cd "$dir"
            pnpm install || echo "âš ï¸ pnpm install failed for $dir"
            cd ..
        fi
    fi
done

echo "âœ… Project dependencies setup completed"